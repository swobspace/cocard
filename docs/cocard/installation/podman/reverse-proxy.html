<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Reverse Proxy zur Absicherung von Cocard :: Cocard</title>
    <meta name="generator" content="Antora 3.1.12">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="../../..">Cocard</a>
      <div class="navbar-item search hide-for-print">
        <div id="search-field" class="field">
          <input id="search-input" type="text" placeholder="Suche ...">
        </div>
      </div>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div class="abstand">
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
          <div class="navbar-item dark">Cocard</div>
           <a class="navbar-item" href="../../../devnotes/index.html">DevNotes</a>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="cocard" data-version="">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../../index.html">Cocard</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../index.html">Cocard</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../user/dashboard.html">Dashboard</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../user/common.html">Allgemeines zur Oberfläche</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../user/conditions.html">Zustände</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../user/connector.html">Konnektor</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../user/card-terminal.html">Kartenterminal</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../user/card.html">Karte</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../user/logs.html">Event Logs</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../user/acknowledges.html">Notizen und Acknowledges</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../user/ti-lagebild.html">TI-Lagebild</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../user/verify-pin.html">PIN-Verifizierung</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../user/workplaces.html">Arbeitsplätze</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../user/tags.html">Tags</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Administration</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Konnektor</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../admin/connector-edit.html">Konnektor anlegen/bearbeiten</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../admin/connector-autoreboot.html">Automatischer Reboot</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../admin/card-terminal-edit.html">Kartenterminal anlegen/bearbeiten</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../admin/idle-messages-edit.html">Ruhebildschirme setzen</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../admin/card-new.html">Karte anlegen/bearbeiten</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../admin/contexts.html">Kontexte</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../admin/locations.html">Standorte</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../admin/networks.html">Netzwerke</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../admin/operational_states.html">Betriebszustände</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../admin/jobs.html">Jobverwaltung</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../admin/authorities.html">Berechtigungen</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../admin/smcb-remote-pin.html">Remote PIN für SMC-B Karten</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../admin/client-certificates.html">Client-Zertifikate</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../admin/ldap-authentication.html">LDAP-Authentifikation</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../index.html">Installation</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="quickstart.html">Quickstart: podman pods</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../first-steps.html">Erste Schritte</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="podman-compose.html">Quickstart: docker-compose</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../first-steps.html">Erste Schritte</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="podman-systemd.html">Systemd und Quadlets</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="reverse-proxy.html">Reverse Proxy</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../configuration.html">Konfiguration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../checkmk.html">CheckMK Integration</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Cocard</span>
    <span class="version">default</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../../index.html">Cocard</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../../index.html">default</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../devnotes/index.html">DevNotes</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../devnotes/index.html">default</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../../index.html">Cocard</a></li>
    <li><a href="../index.html">Installation</a></li>
    <li><a href="reverse-proxy.html">Reverse Proxy</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Reverse Proxy zur Absicherung von Cocard</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>In produktiven Umgebungen sichert man Webserver in Containern fast immer über einen Reverse Proxy ab. Der Reverse Proxy ist sicher von außen zu erreichen, stellt TLS/HTTPS und ggf. eine zusätzliche Authentifikation zur Verfügung.
Der Zugriff zwischen Reverse Proxy und Container kann dann einfach über HTTP erfolgen, der Aufwand für die Konfiguration von TLS in den Containern kann entfallen.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/podman/reverse-proxy.svg" alt="reverse proxy">
</div>
</div>
<div class="paragraph">
<p>Cocard benutzt Websockets, d.h. es gibt hier zweite Verbindung, die man separat im Proxy berücksichtigen muss, wenn man z.B. Apache einsetzt. Bei Traefik entfällt eine Sonderbehandlung der Websockets.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_traefik"><a class="anchor" href="#_traefik"></a>Traefik</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="title">Traefik: directory and files</div>
<div class="content">
<pre>/etc/containers/systemd/users/1001/traefik
├── <a href="../_attachments/podman/quadlet/traefik.yaml" class="xref attachment">traefik.yml</a>
├── <a href="../_attachments/podman/quadlet/traefik.container" class="xref attachment">traefik.container</a>
├── <a href="../_attachments/podman/quadlet/traefik.network" class="xref attachment">traefik.network</a></pre>
</div>
</div>
<div class="paragraph">
<p>In der Beispielkonfiguration öffnet Traefik den Port 8443 für den HTTPS-Zugriff. Die mitgelieferte Konfiguration ist so nicht lauffähig und benötigt Anpassungen auf die eigene Umgebung einschließlich der dazu passenden Zertifikate.</p>
</div>
<div class="paragraph">
<p>Traefik konfiguriert für den Container über das Basis-Setup hinaus mit Labels; diese ergänzt man in <code>cocard.container</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">Network=traefik.network
Label=traefik.enable=true
Label=traefik.http.routers.cocard.rule=Host(`cocard.example.com`)
Label=traefik.http.routers.cocard.entrypoints=websecure
Label=traefik.http.routers.cocard.tls=true
Label=traefik.http.routers.cocard.service=svc-cocard
Label=traefik.http.services.svc-cocard.loadbalancer.server.port=3000</code></pre>
</div>
</div>
<div class="paragraph">
<p>Die Beispielkonfiguration nutzt ein eigenes Netzwerk für die Kommunikation zwischen Container und Traefik (<code>traefik.network</code>). Das Netzwerk muss daher zusätzlich zum Cocard-internen Netzwerk im Quadlet <code>cocard.container</code> vorhanden sein.</p>
</div>
<div class="sect2">
<h3 id="_podman_socket"><a class="anchor" href="#_podman_socket"></a>podman.socket</h3>
<div class="paragraph">
<p>Traefik liest die containerspezifische Dokumentation über eine Socket aus. Bei Docker ist dieser Socket standardmäßig aktiv, bei Podman muss er explizit gestartet werden:</p>
</div>
<div class="listingblock">
<div class="title">User poddy</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-sh hljs" data-lang="sh">systemctl --user start podman.socket
systemctl --user enable podman.socket</code></pre>
</div>
</div>
<div class="paragraph">
<p>Weitere Infos zum Socket erhält man unter <a href="https://github.com/containers/podman/blob/main/docs/tutorials/socket_activation.md" class="bare">https://github.com/containers/podman/blob/main/docs/tutorials/socket_activation.md</a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_apache_2_4"><a class="anchor" href="#_apache_2_4"></a>Apache 2.4</h2>
<div class="sectionbody">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Ich benutze Apache nicht länger als Reverse Proxy, das Folgende ist daher nur eine Gedankenstütze und keine lauffähige abschließende Konfiguration.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-apache hljs" data-lang="apache">&lt;VirtualHost *:443&gt;
...
  &lt;Location "/"&gt;
    ProxyPass http://127.0.0.1:3000/
    ProxyPassReverse http://127.0.0.1:3000/
  &lt;/Location&gt;

  &lt;Location /cable&gt;
    ProxyPass ws://127.0.0.1:3000/cable
    ProxyPassReverse ws://127.0.0.1:3000/cable
  &lt;/Location&gt;

  &lt;Proxy *&gt;
    Order deny,allow
    Allow from all
  &lt;/Proxy&gt;

  SSLEngine On
  SSLCertificateKeyFile ....
  SSLCertificateFile ...
  ...
&lt;/VirtualHost&gt;</code></pre>
</div>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <span>Wolfgang Barth (C) 2024-2025</span>
</footer>
<script src="../../../_/js/site.js"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
<script src="../../../_/js/vendor/medium-zoom.min.js"></script>
<script>mediumZoom('img:not(.copy-icon');</script>
<script src="../../../_/js/vendor/lunr.js"></script>
<script src="../../../_/js/vendor/lunr-languages.js"></script>
<script src="../../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../../.." data-snippet-length="100" data-stylesheet="../../../_/css/search.css"></script>
<script async src="../../../search-index.js"></script>
  </body>
</html>
