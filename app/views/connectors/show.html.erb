<%= render 'shared/turbo-cache-control' %>

<%= turbo_stream_from @connector %>
<%= turbo_stream_from [ current_user, @connector ] %>

<div class="card mb-3">
  <div class="card-header">
    <div class="d-flex w-100">
      <div >
        <span class="subtitle">
          <%= t('activerecord.models.connector') %>:
          #<%= @connector.id %>
        </span>
        <h4 class="title"> <%= @connector %> </h4>
      </div>
      <div class="ms-3 pt-3">
        <%= render ConditionIconComponent.new(item: @connector) %>
      </div>
      <div role="toolbar" class="ms-auto pt-3">
        <%= link_to(raw(%Q[<i class="fa-solid fa-fw fa-list-check"></i>]),
                    test_context_form_connector_path(@connector),
                    title: "Test eines Kontextes",
                    class: 'btn btn-secondary me-1')
         %>
        <%= render RebootButtonComponent.new(item: @connector) if can? :reboot, @connector %>
        <%= render HealthCheckButtonComponent.new(item: @connector) %>
        <%= button_to(t('cocard.fetch_sds'),
                      fetch_sds_connector_path(@connector),
                      class: 'btn btn-warning me-1') if can? :manage, @connector 
         %>
        <% if @connector.manual_update %>
          <%= button_to(t('cocard.get_resource_information'),
                        get_resource_information_connector_path(@connector),
                        class: 'btn btn-warning me-1') if can? :manage, @connector 
           %>
          <%= button_to(t('cocard.get_card_terminals'),
                        get_card_terminals_connector_path(@connector),
                        class: 'btn btn-warning me-1') if can? :manage, @connector 
           %>
          <%= button_to(t('cocard.get_cards'),
                        get_cards_connector_path(@connector),
                        class: 'btn btn-warning me-1') if can? :manage, @connector 
           %>
        <% end %>
        <%= render AcknowledgeButtonComponent.new(
                     notable: @connector, small: false,
                     readonly: cannot?(:manage, @connector)
                   )
         %>

        <%= edit_link(@connector) %>
        <%= delete_link(@connector) %>
      </div>
    </div>
  </div>

  <div class="card-body">
    <div class="row">
      <div class="col-xl-10">
        <%= render partial: 'show' %>
      </div>
      <div class="col-xl-2 bg-light">
        <div class="mb-3">
          <%= turbo_frame_tag("side_notes", src: sindex_connector_notes_path(@connector), 
                                            refresh: "morph") %>
        </div>
      </div>
    </div>
  </div>
</div>

<%= back_link %>
<%= new_link Connector %>

<% unless @connector.deleted? %>
  <ul class="nav nav-tabs mt-3" id="ConnectorsTab" role="tablist" data-turbo-permanent>
    <li class="nav-item" role="presentation">
      <button class="nav-link active" id="card-terminals-tab" data-bs-toggle="tab" data-bs-target="#card-terminals-tab-pane" type="button" role="tab" aria-controls="card-terminals-tab-pane" aria-selected="false">Kartenterminals</button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="cards-tab" data-bs-toggle="tab" data-bs-target="#cards-tab-pane" type="button" role="tab" aria-controls="cards-tab-pane" aria-selected="false">SMC-Bs</button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="logs-tab" data-bs-toggle="tab" data-bs-target="#logs-tab-pane" type="button" role="tab" aria-controls="logs-tab-pane" aria-selected="true">Logs</button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="notes-tab" data-bs-toggle="tab" data-bs-target="#notes-tab-pane" type="button" role="tab" aria-controls="notes-tab-pane" aria-selected="false">Notizen</button>
    </li>
  </ul>

  <div class="tab-content" id="ConnectorsTabContent" data-turbo-permanent>
    <div class="tab-pane fade show active" id="card-terminals-tab-pane" role="tabpanel" aria-labelledby="card-terminals-tab" tabindex="0">
      <div class="card my-3">
        <div class="card-header">
          <div class="d-flex w-100">
            <div class="d-flex w-100 justify-content-between">
              <h4 class="title"> 
                <%= t('controller.card_terminals') %>
              </h4>
              <div role="toolbar" class="pt-0">
                <%= link_to raw(%Q[<i class="fas fa-table"></i>]),
                      connector_card_terminals_path(@connector),
                      class: 'btn btn-outline-secondary btn-sm',
                      data: { "turbo-frame" => "_top" }
                 %>
              </div>
            </div>
          </div>
        </div>
        <div class="m-2">
          <%= render 'card_terminals/list', card_terminals: @connector.card_terminals %>
        </div>
      </div>
    </div>

    <div class="tab-pane fade" id="cards-tab-pane" role="tabpanel" aria-labelledby="cards-tab" tabindex="0">
      <%= turbo_frame_tag("connector_cards", src: connector_cards_path(@connector),
                                  refresh: "morph") %>
    </div>

    <div class="tab-pane fade" id="logs-tab-pane" role="tabpanel" aria-labelledby="logs-tab" tabindex="0">
      <%= turbo_frame_tag("logs", src: connector_logs_path(@connector, valid: 1),
                                  refresh: "morph") %>
    </div>

    <div class="tab-pane fade" id="notes-tab-pane" role="tabpanel" aria-labelledby="notes-tab" tabindex="0">
      <%= turbo_frame_tag("notes", src: polymorphic_path([@connector, :notes], active: 1),
                                   refresh: "morph") %>

    </div>
  </div>
<% end %>
