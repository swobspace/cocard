<%= turbo_frame_tag "cards" do %>
 <% if @cards.size > 0 %>
  <%= content_tag :table,
        id: "cards_table",
        class: "table tablesm mb-0" do %>
    <thead>
      <tr class="">
        <th class="text-center"><%= t('attributes.condition') %></th>
        <th><%= t('attributes.card_type') %></th>
        <th><%= t('attributes.name') %></th>
        <th><%= t('attributes.condition_message') %></th>
        <% if @current_user.is_admin? %>
          <th></th>
        <% end %>
        <th><%= t('attributes.iccsn') %></th>
        <th><%= t('attributes.connector') %></th>
        <th><%= t('attributes.card_terminal') %></th>
      </tr>
    </thead>
    <tbody>
      <% @cards.each do |card| %>
        <%= content_tag(:tr, id: dom_id(card)) do %>
          <td class="text-center">
            <%= render ConditionIconComponent.new(item: card, small: true) %>
          </td>
          <td><%= card.card_type %></td>
          <td><%= card.name_or_cardholder %></td>
          <td><%= card.condition_message %></td>
          <% if @current_user.is_admin? %>
            <td>
              <% card.card_contexts.where(pin_status: 'VERIFIABLE').each do |cctx| %>
                <%= render Card::VerifyPinComponent.new(card: card, context: cctx.context) %>

              <% end %>
            </td>
          <% end %>
          <td><%= link_to(card.iccsn, card_path(card),
                    data: { "turbo-frame" => "_top" },
                    class: "primary-link") %></td>
          <td><%= link_to(card.card_terminal&.connector,
                          connector_path(card.card_terminal&.connector),
                          data: { "turbo-frame" => "_top" },
                          class: "primary-link"
                         ) if card.card_terminal&.connector %></td>
          <td><%= link_to(card.card_terminal&.ct_id,
                          card_terminal_path(card.card_terminal),
                          data: { "turbo-frame" => "_top" },
                          class: "primary-link"
                         ) if card.card_terminal %></td>
        <% end %>
      <% end %>
    </tbody>
  <% end %>

  <% if @pagy.pages > 1 %>
    <div class="mt-3 ms-3">
      <%== pagy_bootstrap_nav(@pagy) %>
    </div>
  <% end %>
 <% end %>
<% end %>
