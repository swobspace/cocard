<div class="card mb-3">
 <% if @card_terminal %>
 <%= turbo_stream_from [ current_user, @card_terminal ] %>
  <div class="card-header">
    <div class="d-flex w-100">
      <div>
        <span class="subtitle">
          <%= render LinkToComponent.new(item: @card_terminal.connector) %>
        </span>
        <h4 class="title"><%= render LinkToComponent.new(item: @card_terminal) %></h4>
      </div>
      <div class="ms-3 pt-3">
        <%= render ConditionIconComponent.new(item: @card_terminal) %>
      </div>
      <div role="toolbar" class="ms-auto pt-3">
        <%= render RebootButtonComponent.new(item: @card_terminal) if (can? :reboot, @card_terminal) %>
        <%= render CardTerminal::PairingButtonComponent
                   .new(card_terminal: @card_terminal) if (can? :manage, @card_terminal) %>
        <%= render HealthCheckButtonComponent.new(item: @card_terminal) %>
        <%= render AcknowledgeButtonComponent.new(
                     notable: @card_terminal, small: false,
                     readonly: cannot?(:manage, @card_terminal)
                   )
         %>
        <%= edit_link(@card_terminal) %>
        <%= delete_link(@card_terminal) %>
      </div>
    </div>
  </div>
 <% end %>

  <div class="card-body">
   <% if @value.present? %>
    <table class="table autowidth">
      <thead>
      </thead>
      <tbody>
        <% @value.class::ATTRIBUTES.each do |attr| %>
          <%= render DuckTerminalTrComponent.new(card_terminal: @card_terminal, 
                                                 info: @value, attrib: attr) %>
        <% end %>
      </tbody>
      <tfoot>
        <th class="bg-secondary bg-opacity-25">Legende</th>
        <td class="bg-secondary bg-opacity-25">
            Grün: Wert entspricht dem Default; 
            Gelb: Wert weicht vom Default ab;
            Rot: MAC-Adresse/Terminalname abweichend vom den Daten in Cocard - 
                 bitte prüfen und korrigieren!
            Weiß: kein Defaultwert vorhanden oder Vergleich nicht sinnvoll 
                  (z.B. bei IP-Adressen)
            <%= link_to '[ Zur Konfiguration ]', 'docs/cocard/installation/cocard_yml.html',
                        class: 'primary-link' %>
        </td>
      </tfoot>
    </table>
   <% else %>
     <%= @message %>
   <% end %>
  </div>
</div>

<%= back_link %>
<%= link_to "Neue Prüfung", new_duck_terminal_path,
    class: 'btn btn-secondary' %>

<div class="mt-3">
  <h4>Kartenterminals mit der IP <%= @ducky.ip %></h4>
</div>

<div class="list-group">
  <% CardTerminal.where(ip: @ducky.ip).each do |ct| %>
    <%= render partial: 'card_terminal', 
               locals: { 
                 card_terminal: ct,  
                 color: if @value.present?
                          (@value&.macaddr == ct.mac) ? 'bg-success' : 'bg-danger'
                        else
                          'bg-light'
                        end
               }
     %>
  <% end %>
</div>
